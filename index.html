<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Phonetic Mastery | Rators Club</title>
    
    <link rel="icon" href="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128" type="image/png">
    
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Nunito+Sans:wght@300;400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        /* ========================================
           SISTEMA DE DISEÑO: PREMIUM PHONETICS
           ======================================== */
        :root {
            --bg-color: #fdfcf9; 
            --surface-color: #ffffff;
            --surface-hover: #f4f5f7;
            --header-bg: rgba(255, 255, 255, 0.92);
            
            --text-main: #1f2937;
            --text-muted: #6b7280;
            
            --primary: #3730a3; 
            --primary-light: rgba(55, 48, 163, 0.05);
            --secondary: #059669; 
            --secondary-light: rgba(5, 150, 105, 0.05);
            --accent: #d97706; 
            --danger: #dc2626;
            --danger-light: rgba(220, 38, 38, 0.05);
            
            --border-color: #e5e7eb;
            --border-focus: rgba(55, 48, 163, 0.2);
            
            --glow-static: 0 8px 25px rgba(55, 48, 163, 0.06);
            --glow-hover: 0 15px 40px rgba(55, 48, 163, 0.15);
            --glow-mic: 0 0 30px rgba(220, 38, 38, 0.4);
            
            --radius-soft: 16px;
            --radius-card: 28px;
        }

        .dark-mode {
            --bg-color: #0f1115; 
            --surface-color: #1a1d24;
            --surface-hover: #252932;
            --header-bg: rgba(15, 17, 21, 0.92);
            
            --text-main: #f3f4f6;
            --text-muted: #9ca3af;
            
            --primary: #818cf8; 
            --primary-light: rgba(129, 140, 248, 0.1);
            --secondary: #34d399; 
            --secondary-light: rgba(52, 211, 153, 0.1);
            
            --border-color: #2d3139;
            --border-focus: rgba(129, 140, 248, 0.4);
            
            --glow-static: 0 8px 25px rgba(129, 140, 248, 0.08);
            --glow-hover: 0 15px 40px rgba(129, 140, 248, 0.25);
            --glow-mic: 0 0 40px rgba(239, 68, 68, 0.6);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; overflow-x: hidden; scroll-behavior: smooth; }
        
        body { 
            font-family: 'Nunito Sans', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            transition: background-color 0.6s ease, color 0.6s ease; 
            line-height: 1.8;
            font-size: 17px;
        }

        h1, h2, h3, .serif-text { font-family: 'Lora', serif; font-weight: 600; }

        .learning-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
            background-size: 40px 40px; opacity: 0.4; transition: opacity 0.5s ease;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(25px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulseMic {
            0% { transform: scale(1); box-shadow: var(--glow-mic); }
            50% { transform: scale(1.05); box-shadow: 0 0 50px rgba(220, 38, 38, 0.6); }
            100% { transform: scale(1); box-shadow: var(--glow-mic); }
        }

        header {
            padding: 1.2rem 3.5rem; display: flex; justify-content: space-between; align-items: center;
            background: var(--header-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            position: sticky; top: 0; z-index: 2000; border-bottom: 1px solid var(--border-color);
            transition: all 0.4s ease; box-shadow: 0 4px 20px rgba(0,0,0,0.02);
        }
        
        .header-brand { display: flex; align-items: center; gap: 18px; text-decoration: none; color: inherit; transition: 0.3s; }
        .header-brand:hover { transform: translateY(-2px); }
        
        .logo-box { 
            width: 55px; height: 55px; border-radius: 16px; 
            display: flex; align-items: center; justify-content: center; 
            background: var(--surface-color); overflow: hidden; border: 2px solid var(--border-focus);
            box-shadow: var(--glow-static); transition: 0.4s ease;
        }
        .header-brand:hover .logo-box { box-shadow: var(--glow-hover); border-color: var(--primary); }
        .logo-box img { width: 100%; height: 100%; object-fit: cover; }
        
        .brand-text { font-family: 'Nunito Sans', sans-serif; font-size: 1.6rem; font-weight: 800; letter-spacing: -0.5px; color: var(--primary); }

        .menu-trigger { 
            background: var(--surface-color); border: 1px solid var(--border-color); 
            width: 50px; height: 50px; border-radius: 14px; cursor: pointer; 
            color: var(--text-main); font-size: 1.2rem; display: flex; align-items: center; justify-content: center; 
            transition: 0.3s ease; box-shadow: var(--glow-static);
        }
        .menu-trigger:hover { background: var(--primary-light); color: var(--primary); border-color: var(--primary); box-shadow: var(--glow-hover); }

        .sidebar { 
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%; 
            background: var(--surface-color); z-index: 3000; 
            transition: right 0.5s cubic-bezier(0.16, 1, 0.3, 1); padding: 3rem 2.5rem; 
            border-left: 1px solid var(--border-color); box-shadow: -15px 0 50px rgba(0,0,0,0.08);
            display: flex; flex-direction: column;
        }
        .sidebar.active { right: 0; }
        
        .sidebar-close {
            background: none; border: none; font-size: 2rem; align-self: flex-end; 
            color: var(--text-muted); cursor: pointer; transition: 0.3s; margin-bottom: 2rem;
        }
        .sidebar-close:hover { color: var(--text-main); transform: scale(1.1) rotate(90deg); }

        .nav-title { font-size: 0.85rem; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 1.5rem; padding-left: 5px; }

        .side-btn { 
            width: 100%; padding: 18px 22px; border: 1px solid transparent; border-radius: var(--radius-soft); 
            background: transparent; color: var(--text-muted); font-weight: 600; text-align: left; 
            cursor: pointer; display: flex; align-items: center; gap: 18px; text-decoration: none; 
            font-size: 1.1rem; transition: 0.3s; font-family: 'Nunito Sans', sans-serif; margin-bottom: 10px;
        }
        .side-btn i { font-size: 1.3rem; width: 30px; text-align: center; transition: 0.3s; color: var(--text-muted); opacity: 0.8;}
        
        .side-btn:hover { background: var(--surface-hover); color: var(--text-main); transform: translateX(-5px); border-color: var(--border-color); }
        .side-btn:hover i { color: var(--primary); opacity: 1; }
        
        .side-btn.active { background: var(--primary-light); color: var(--primary); font-weight: 700; border-color: var(--border-focus); box-shadow: inset 0 0 15px rgba(55, 48, 163, 0.03); }
        .side-btn.active i { color: var(--primary); opacity: 1; }

        .theme-control {
            margin-top: auto; padding: 22px; border-radius: var(--radius-soft);
            display: flex; justify-content: space-between; align-items: center; 
            background: var(--surface-hover); border: 1px solid var(--border-color);
        }
        .theme-control span { font-size: 0.95rem; font-weight: 700; color: var(--text-main); }
        
        .switch { position: relative; width: 54px; height: 30px; cursor: pointer; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: var(--text-muted); border-radius: 30px; transition: 0.4s; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: 0.4s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input:checked + .slider { background: var(--primary); }
        input:checked + .slider:before { transform: translateX(24px); }

        .container { max-width: 1050px; margin: 0 auto; padding: 4rem 1.5rem; min-height: 80vh; }
        .section { display: none; }
        .section.active { display: block; animation: fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .card { 
            background: var(--surface-color); border: 1px solid var(--border-color); border-radius: var(--radius-card); 
            padding: 4.5rem 3.5rem; margin-bottom: 3rem; box-shadow: var(--glow-static); 
            position: relative; overflow: hidden;
        }
        
        h1 { font-size: clamp(2.8rem, 7vw, 4rem); color: var(--text-main); line-height: 1.15; margin-bottom: 1.5rem; letter-spacing: -1px;}
        h1 span { color: var(--primary); }
        h2 { font-size: 2rem; margin: 3.5rem 0 1.5rem; color: var(--text-main); }
        p { font-size: 1.15rem; color: var(--text-muted); margin-bottom: 1.5rem; }
        
        .lang-en { font-family: 'JetBrains Mono', monospace; background: var(--primary-light); padding: 4px 10px; border-radius: 8px; font-weight: 700; color: var(--primary); font-size: 1.1rem; }
        
        .explainer-box { background: var(--surface-hover); border-left: 6px solid var(--primary); padding: 2.5rem; border-radius: 16px; margin: 3rem 0; }
        .explainer-box p { color: var(--text-main); margin-bottom: 0; font-weight: 500; }

        .rule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 2rem; }
        .rule-box { padding: 30px; border-radius: 20px; border: 1px solid var(--border-color); background: var(--bg-color); transition: 0.4s; }
        .rule-box:hover { transform: translateY(-5px); box-shadow: var(--glow-static); border-color: var(--primary); }
        .rule-box h3 { font-size: 1.5rem; color: var(--primary); margin-bottom: 15px; }

        /* --- Audio & Voice Interface --- */
        .audio-trigger { 
            background: var(--surface-color); color: var(--primary); border: 2px solid var(--primary); 
            padding: 18px 36px; border-radius: 30px; cursor: pointer; font-weight: 700; 
            display: inline-flex; align-items: center; gap: 15px; font-size: 1.15rem; transition: 0.3s;
            box-shadow: var(--glow-static); font-family: 'Nunito Sans', sans-serif;
        }
        .audio-trigger:hover { background: var(--primary); color: white; transform: translateY(-3px); box-shadow: var(--glow-hover); }

        .mic-btn {
            width: 90px; height: 90px; border-radius: 50%; background: var(--surface-color); border: 3px solid var(--border-color);
            display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--text-muted);
            cursor: pointer; margin: 2rem auto; transition: 0.4s; box-shadow: var(--glow-static);
        }
        .mic-btn:hover { border-color: var(--primary); color: var(--primary); transform: scale(1.05); }
        .mic-btn.recording { background: var(--danger); border-color: var(--danger); color: white; animation: pulseMic 1.5s infinite; }

        .voice-feedback { margin-top: 1.5rem; font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; min-height: 40px; color: var(--text-main); font-weight: 700; }
        .voice-target { font-size: 1.8rem; font-weight: 800; color: var(--primary); margin-bottom: 1rem; font-family: 'Lora', serif; }

        /* Ear Training Grid */
        .ear-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 2rem; }
        .ear-option { padding: 25px; border-radius: 20px; border: 2px solid var(--border-color); background: var(--surface-color); font-size: 1.5rem; font-weight: 700; cursor: pointer; transition: 0.3s; font-family: 'JetBrains Mono', monospace; color: var(--text-main); }
        .ear-option:hover { border-color: var(--primary); background: var(--primary-light); transform: translateY(-3px); }

        /* ILUO Evaluation Result */
        .iluo-box { display: none; text-align: center; padding: 3rem; border-radius: 24px; margin-top: 2rem; border: 2px solid; }
        .iluo-iniciado { background: rgba(220, 38, 38, 0.05); border-color: var(--danger); color: var(--danger); }
        .iluo-limitado { background: rgba(217, 119, 6, 0.05); border-color: var(--accent); color: var(--accent); }
        .iluo-utilizable { background: rgba(5, 150, 105, 0.05); border-color: var(--secondary); color: var(--secondary); }
        .iluo-operativo { background: rgba(55, 48, 163, 0.05); border-color: var(--primary); color: var(--primary); }

        .btn-action {
            display: inline-flex; align-items: center; justify-content: center; gap: 15px; 
            background: var(--primary); color: #ffffff; padding: 20px 40px; border-radius: 30px; 
            text-decoration: none; font-weight: 700; font-size: 1.2rem; margin-top: 2rem; 
            transition: 0.4s; border: none; cursor: pointer; width: 100%; box-shadow: var(--glow-static);
            font-family: 'Nunito Sans', sans-serif;
        }
        .btn-action:hover { transform: translateY(-5px); box-shadow: var(--glow-hover); }

        .wa-float { 
            position: fixed; bottom: 40px; left: 40px; background: #25d366; color: white; 
            width: 75px; height: 75px; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 38px; z-index: 4000; box-shadow: 0 10px 30px rgba(37, 211, 102, 0.3);
            text-decoration: none; transition: 0.4s; border: 3px solid var(--surface-color);
        }
        .wa-float:hover { transform: translateY(-8px) scale(1.1); box-shadow: 0 15px 40px rgba(37, 211, 102, 0.5); }

        footer { padding: 5rem 3rem 3rem; text-align: center; border-top: 1px solid var(--border-color); margin-top: 6rem; background: var(--surface-color); color: var(--text-muted); }
        .footer-brand { font-family: 'Lora', serif; font-size: 2rem; font-weight: 700; color: var(--text-main); margin-bottom: 1rem; }

        @media (max-width: 768px) {
            header { padding: 1rem 1.5rem; }
            .container { padding: 2.5rem 1.2rem; }
            .card { padding: 3rem 1.8rem; }
            .wa-float { width: 65px; height: 65px; font-size: 34px; bottom: 25px; left: 25px; }
            .ear-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body onclick="unlockAudio()">

<div class="learning-bg"></div>

<header>
    <div class="header-brand" onclick="nav('home')">
        <div class="logo-box"><img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w256" alt="Rators Logo"></div>
        <div class="brand-text">Phonetics Lab</div>
    </div>
    <button class="menu-trigger" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
</header>

<div class="sidebar" id="sidebar">
    <button class="sidebar-close" onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
    <div class="nav-title">Ruta de Práctica</div>
    <div style="display: flex; flex-direction: column; gap: 5px;">
        <button class="side-btn active" onclick="nav('home', this)"><i class="fas fa-home"></i> Introducción</button>
        <button class="side-btn" onclick="nav('theory', this)"><i class="fas fa-book-open"></i> Acústica Básica</button>
        <button class="side-btn" onclick="nav('ear', this)"><i class="fas fa-headphones-alt"></i> Ear Training</button>
        <button class="side-btn" onclick="nav('voice', this)"><i class="fas fa-microphone-alt"></i> Voice Studio</button>
    </div>
    <div class="theme-control">
        <span>Modo Lectura</span>
        <label class="switch"><input type="checkbox" id="themeInput" onchange="toggleTheme()"><span class="slider"></span></label>
    </div>
</div>

<div class="container">

    <section id="sec-home" class="section active">
        <div class="card" style="text-align: center;">
            <h1 class="serif-text">El Arte de la <span>Articulación</span></h1>
            <p>La pronunciación no se trata de leer palabras, sino de entrenar nuevos músculos en tu boca y reeducar tu oído para detectar sonidos que no existen en el español.</p>
            
            <div class="explainer-box" style="text-align: left;">
                <p>En este espacio, no utilizaremos la evaluación tradicional de Aprobado/Reprobado. Utilizaremos el estándar <b>ILUO</b> (Iniciado, Limitado, Utilizable, Operativo) para medir tu capacidad real de comunicación fonética.</p>
            </div>

            <button class="btn-action" onclick="nav('theory')">Comenzar el entrenamiento <i class="fas fa-arrow-right"></i></button>
        </div>
    </section>

    <section id="sec-theory" class="section">
        <div class="card">
            <h1 class="serif-text">Acústica <span style="color: var(--secondary);">Básica</span></h1>
            <p>Antes de hablar, debemos entender por qué los hispanohablantes cometemos errores. El mayor problema son las vocales.</p>
            
            <div class="rule-grid">
                <div class="rule-box">
                    <h3>La Vocal Corta /ɪ/</h3>
                    <p>En español solo tenemos una "i". En inglés, la /ɪ/ corta suena casi como una mezcla entre "i" y "e". Es rápida y seca.</p>
                    <p style="margin-top: 15px;"><span class="lang-en">Ship</span> (Barco)</p>
                    <p><span class="lang-en">Hit</span> (Golpear)</p>
                </div>

                <div class="rule-box" style="border-color: var(--primary);">
                    <h3 style="color: var(--primary);">La Vocal Larga /i:/</h3>
                    <p>Esta es como nuestra "i" en español, pero extendida. Tienes que sonreír levemente para pronunciarla.</p>
                    <p style="margin-top: 15px;"><span class="lang-en">Sheep</span> (Oveja)</p>
                    <p><span class="lang-en">Heat</span> (Calor - *Cuidado con la H aspirada)</p>
                </div>
            </div>

            <button class="btn-action" style="background: var(--surface-color); color: var(--text-main); border: 2px solid var(--border-color); box-shadow: none;" onclick="nav('ear')">Afinar el oído <i class="fas fa-headphones"></i></button>
        </div>
    </section>

    <section id="sec-ear" class="section">
        <div class="card" style="text-align: center;">
            <h1 class="serif-text">Ear <span style="color: var(--accent);">Training</span></h1>
            <p>Si no puedes escuchar la diferencia, no podrás pronunciarla. Escucha el audio y selecciona la palabra correcta (Minimal Pairs).</p>
            
            <div style="margin: 3rem 0; padding: 3rem 2rem; background: var(--bg-color); border-radius: 20px; border: 1px solid var(--border-color);">
                <button class="audio-trigger" onclick="playEarAudio()"><i class="fas fa-volume-up"></i> Reproducir Sonido</button>
                
                <div class="ear-grid" id="earGrid">
                    </div>
                
                <p id="earFeedback" style="margin-top: 2rem; font-weight: 700; height: 30px; color: var(--primary);"></p>
            </div>
            
            <button class="btn-action" onclick="nav('voice')">Ir al Estudio de Grabación <i class="fas fa-microphone"></i></button>
        </div>
    </section>

    <section id="sec-voice" class="section">
        <div class="card" style="text-align: center;">
            <h1 class="serif-text">The Voice <span style="color: var(--danger);">Studio</span></h1>
            <p>Es tu turno. Lee la frase en voz alta. El sistema de reconocimiento fonético evaluará tu precisión y determinará tu nivel <b>ILUO</b>.</p>
            
            <div style="background: var(--bg-color); padding: 3rem 2rem; border-radius: 24px; border: 1px solid var(--border-color); margin-top: 2rem;">
                <p style="text-transform: uppercase; font-size: 0.9rem; font-weight: 800; color: var(--text-muted); letter-spacing: 2px;">Target Phrase:</p>
                <div class="voice-target" id="voiceTarget">I want to buy a cheap ship</div>
                
                <button class="mic-btn" id="micBtn" onclick="toggleRecording()"><i class="fas fa-microphone"></i></button>
                <p style="font-size: 0.9rem; color: var(--text-muted);">Haz clic para hablar. Requiere permisos de micrófono.</p>
                
                <div class="voice-feedback" id="voiceFeedback">...</div>
            </div>

            <div class="iluo-box" id="iluoResult">
                <h2 class="serif-text" style="font-size: 2.5rem; margin-bottom: 10px;" id="iluoGrade">INICIADO</h2>
                <p id="iluoDesc" style="font-size: 1.15rem; font-weight: 600;"></p>
            </div>

            <button class="btn-action" style="margin-top: 2rem; background: var(--surface-color); color: var(--text-main); border: 2px solid var(--border-color); box-shadow: none;" onclick="nextVoicePhrase()">Siguiente Frase <i class="fas fa-step-forward"></i></button>
        </div>
    </section>

</div>

<footer>
    <div class="footer-brand">Rators Club</div>
    <p>Teacher Netza Varo • Phonetic Architecture</p>
    <p style="font-size: 0.85rem; margin-top: 2rem; opacity: 0.5;">PLATINUM EDITION 2026 | GNU GPL v3.0</p>
</footer>

<a href="https://wa.me/523231116425?text=Hola%20Teacher%20Netza,%20estoy%20en%20el%20Laboratorio%20de%20Pronunciaci%C3%B3n%20y%20me%20gustar%C3%ADa%20mejorar%20mi%20Speaking." class="wa-float" target="_blank">
    <i class="fab fa-whatsapp"></i>
</a>

<script>
    /* ========================================
       ENGINE: PHONETICS & WEB SPEECH API
       ======================================== */
    
    // --- Audio Synthesis (Text to Speech) ---
    let audioUnlocked = false;
    function unlockAudio() { if(!audioUnlocked) { window.speechSynthesis.speak(new SpeechSynthesisUtterance("")); audioUnlocked = true; } }
    
    function speakWord(word) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(word);
        msg.lang = 'en-US'; msg.rate = 0.8;
        window.speechSynthesis.speak(msg);
    }

    // --- Navegación ---
    function nav(id, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        setTimeout(() => { document.getElementById('sec-' + id).classList.add('active'); }, 50);
        document.querySelectorAll('.side-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        if(document.getElementById('sidebar').classList.contains('active')) toggleSidebar();
        window.scrollTo(0,0);
        
        if(id === 'ear') initEarTraining();
        if(id === 'voice') initVoiceStudio();
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
    function toggleTheme() { document.body.classList.toggle('dark-mode'); }

    // --- Módulo 1: Ear Training (Minimal Pairs) ---
    const earData = [
        { target: "Ship", wrong: "Sheep" },
        { target: "Hit", wrong: "Heat" },
        { target: "Tree", wrong: "Three" },
        { target: "Walk", wrong: "Work" },
        { target: "Desk", wrong: "Disk" }
    ];
    let currentEarIdx = 0;

    function initEarTraining() {
        const data = earData[currentEarIdx];
        const grid = document.getElementById('earGrid');
        grid.innerHTML = '';
        document.getElementById('earFeedback').innerText = '';

        let options = [data.target, data.wrong].sort(() => Math.random() - 0.5);
        
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'ear-option';
            btn.innerText = opt;
            btn.onclick = () => checkEarAnswer(opt, data.target);
            grid.appendChild(btn);
        });
    }

    function playEarAudio() { speakWord(earData[currentEarIdx].target); }

    function checkEarAnswer(selected, correct) {
        const fb = document.getElementById('earFeedback');
        if(selected === correct) {
            confetti({ particleCount: 50, spread: 50, origin: { y: 0.6 } });
            fb.style.color = "var(--secondary)";
            fb.innerText = "¡Excelente oído! Avanzando...";
            setTimeout(() => {
                currentEarIdx = (currentEarIdx + 1) % earData.length;
                initEarTraining();
            }, 1500);
        } else {
            fb.style.color = "var(--danger)";
            fb.innerText = "Escucha de nuevo. La vocal tiene otra duración.";
        }
    }

    // --- Módulo 2: Voice Studio (Web Speech API) & Evaluación ILUO ---
    const voicePhrases = [
        "I want to buy a cheap ship",
        "The heat hit me hard",
        "There are three trees",
        "I walk to work every day"
    ];
    let currentVoiceIdx = 0;
    let voiceScore = 0; // Para calcular el ILUO
    let totalAttempts = 0;

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    let isRecording = false;

    function initVoiceStudio() {
        document.getElementById('voiceTarget').innerText = voicePhrases[currentVoiceIdx];
        document.getElementById('voiceFeedback').innerText = "...";
        document.getElementById('iluoResult').style.display = 'none';
        
        if (!SpeechRecognition) {
            document.getElementById('voiceFeedback').innerText = "Tu navegador no soporta reconocimiento de voz. Usa Google Chrome.";
            document.getElementById('micBtn').style.display = 'none';
            return;
        }

        recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.onstart = function() {
            isRecording = true;
            document.getElementById('micBtn').classList.add('recording');
            document.getElementById('voiceFeedback').innerText = "Escuchando...";
        };

        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript.toLowerCase().trim();
            const target = voicePhrases[currentVoiceIdx].toLowerCase().trim();
            
            // Eliminar puntuación básica para comparar
            const cleanTranscript = transcript.replace(/[.,]/g, '');
            const cleanTarget = target.replace(/[.,]/g, '');

            document.getElementById('voiceFeedback').innerText = `Tú dijiste: "${transcript}"`;
            totalAttempts++;

            if(cleanTranscript === cleanTarget) {
                confetti({ particleCount: 150, spread: 80 });
                voiceScore++;
                setTimeout(() => evaluateILUO(), 1000);
            } else {
                setTimeout(() => evaluateILUO(), 1500);
            }
        };

        recognition.onerror = function(event) {
            document.getElementById('voiceFeedback').innerText = "Error: " + event.error;
            stopRecording();
        };

        recognition.onend = function() { stopRecording(); };
    }

    function toggleRecording() {
        if (!recognition) return;
        if (isRecording) { stopRecording(); recognition.stop(); } 
        else { recognition.start(); }
    }

    function stopRecording() {
        isRecording = false;
        document.getElementById('micBtn').classList.remove('recording');
    }

    function nextVoicePhrase() {
        currentVoiceIdx = (currentVoiceIdx + 1) % voicePhrases.length;
        initVoiceStudio();
    }

    // --- Lógica de Evaluación ILUO ---
    function evaluateILUO() {
        const box = document.getElementById('iluoResult');
        const title = document.getElementById('iluoGrade');
        const desc = document.getElementById('iluoDesc');
        
        box.style.display = 'block';
        
        // Reiniciamos clases
        box.className = 'iluo-box';
        
        // Simulación de puntaje basado en intentos vs aciertos
        let ratio = voiceScore / totalAttempts;
        if (totalAttempts === 0) return;

        if (ratio === 1) {
            box.classList.add('iluo-operativo');
            title.innerText = "OPERATIVO";
            desc.innerText = "Pronunciación impecable. Hablas con total fluidez y precisión técnica.";
        } else if (ratio >= 0.6) {
            box.classList.add('iluo-utilizable');
            title.innerText = "UTILIZABLE";
            desc.innerText = "Te das a entender perfectamente, aunque hay leves detalles acústicos por pulir.";
        } else if (ratio >= 0.3) {
            box.classList.add('iluo-limitado');
            title.innerText = "LIMITADO";
            desc.innerText = "Cuidado con los Minimal Pairs. Tu mensaje puede ser malinterpretado por un nativo.";
        } else {
            box.classList.add('iluo-iniciado');
            title.innerText = "INICIADO";
            desc.innerText = "Tu pronunciación aún se basa en las reglas del español. Repasa la teoría acústica.";
        }
    }

</script>

</body>
</html>
